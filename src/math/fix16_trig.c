#include <limits.h>
#include "fix16.h"
#ifdef MATH_FIX16
#if defined(FIXMATH_SIN_LUT)
#include "fix16_trig_sin_lut.h"
#elif !defined(FIXMATH_NO_CACHE)
/* 
#table is generated by the following python
import math
table = []
for i in range(0, 3220):
    theta = i / 65536.0 * 32
    v = int(math.sin(theta) * 65536 + 0.5)
    print '%d,'%v,
    table.append(v)
fix16_pi = int(math.pi * 65536)

print '##############'
def sin(angle):
    neg = 0
    angle = angle % (fix16_pi<<1)
    if angle > fix16_pi:
        neg = 1
        angle = (fix16_pi<<1) - angle;
    if angle > (fix16_pi >> 1):
		angle = fix16_pi - angle;
    tempIndex = ((angle >> 5) & 0x00000FFF); 
    if neg:
        return -table[tempIndex];
    return table[tempIndex];

t = -15
e = 0
while t < 15:
    x = int(65536 * t)
    #print t, x,
    y = sin(x)
    e1 = y / 65536.0 - math.sin(t)
    if e1 > e:
        print e1,
        e = e1
    t += 0.0001

*/
static const fix16_t _fix16_sin_cache_value[]  = { 
	0, 32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, 480, 512, 544, 576, 608, 640, 672, 704, 736, 768, 800, 832, 864, 896, 928, 960, 992, 1024, 1056, 1088, 1120, 1152, 1184, 1216, 1248, 1280, 1312, 1344, 1376, 1408, 1440, 1472, 1504, 1536, 1568, 1600, 1632, 1664, 1696, 1728, 1760, 1792, 1824, 1856, 1888, 1920, 1952, 1984, 2016, 2048, 2080, 2112, 2144, 2176, 2208, 2240, 2272, 2304, 2336, 2367, 2399, 2431, 2463, 2495, 2527, 2559, 2591, 2623, 2655, 2687, 2719, 2751, 2783, 2815, 2847, 2879, 2911, 2943, 2975, 3007, 3039, 3071, 3103, 3135, 3167, 3199, 3231, 3263, 3295, 3327, 3359, 3390, 3422, 3454, 3486, 3518, 3550, 3582, 3614, 3646, 3678, 3710, 3742, 3774, 3806, 3838, 3870, 3902, 3934, 3966, 3998, 4029, 4061, 4093, 4125, 4157, 4189, 4221, 4253, 4285, 4317, 4349, 4381, 4413, 4445, 4477, 4508, 4540, 4572, 4604, 4636, 4668, 4700, 4732, 4764, 4796, 4828, 4860, 4891, 4923, 4955, 4987, 5019, 5051, 5083, 5115, 5147, 5179, 5210, 5242, 5274, 5306, 5338, 5370, 5402, 5434, 5466, 5498, 5529, 5561, 5593, 5625, 5657, 5689, 5721, 5753, 5784, 5816, 5848, 5880, 5912, 5944, 5976, 6008, 6039, 6071, 6103, 6135, 6167, 6199, 6231, 6262, 6294, 6326, 6358, 6390, 6422, 6454, 6485, 6517, 6549, 6581, 6613, 6645, 6676, 6708, 6740, 6772, 6804, 6836, 6867, 6899, 6931, 6963, 6995, 7026, 7058, 7090, 7122, 7154, 7186, 7217, 7249, 7281, 7313, 7345, 7376, 7408, 7440, 7472, 7504, 7535, 7567, 7599, 7631, 7662, 7694, 7726, 7758, 7790, 7821, 7853, 7885, 7917, 7948, 7980, 8012, 8044, 8075, 8107, 8139, 8171, 8202, 8234, 8266, 8298, 8329, 8361, 8393, 8425, 8456, 8488, 8520, 8552, 8583, 8615, 8647, 8678, 8710, 8742, 8774, 8805, 8837, 8869, 8900, 8932, 8964, 8996, 9027, 9059, 9091, 9122, 9154, 9186, 9217, 9249, 9281, 9312, 9344, 9376, 9407, 9439, 9471, 9502, 9534, 9566, 9597, 9629, 9661, 9692, 9724, 9756, 9787, 9819, 9851, 9882, 9914, 9945, 9977, 10009, 10040, 10072, 10104, 10135, 10167, 10198, 10230, 10262, 10293, 10325, 10356, 10388, 10420, 10451, 10483, 10514, 10546, 10578, 10609, 10641, 10672, 10704, 10735, 10767, 10799, 10830, 10862, 10893, 10925, 10956, 10988, 11019, 11051, 11082, 11114, 11146, 11177, 11209, 11240, 11272, 11303, 11335, 11366, 11398, 11429, 11461, 11492, 11524, 11555, 11587, 11618, 11650, 11681, 11713, 11744, 11776, 11807, 11839, 11870, 11902, 11933, 11965, 11996, 12027, 12059, 12090, 12122, 12153, 12185, 12216, 12248, 12279, 12310, 12342, 12373, 12405, 12436, 12468, 12499, 12530, 12562, 12593, 12625, 12656, 12687, 12719, 12750, 12782, 12813, 12844, 12876, 12907, 12938, 12970, 13001, 13033, 13064, 13095, 13127, 13158, 13189, 13221, 13252, 13283, 13315, 13346, 13377, 13409, 13440, 13471, 13503, 13534, 13565, 13597, 13628, 13659, 13690, 13722, 13753, 13784, 13816, 13847, 13878, 13909, 13941, 13972, 14003, 14034, 14066, 14097, 14128, 14159, 14191, 14222, 14253, 14284, 14316, 14347, 14378, 14409, 14441, 14472, 14503, 14534, 14565, 14597, 14628, 14659, 14690, 14721, 14752, 14784, 14815, 14846, 14877, 14908, 14939, 14971, 15002, 15033, 15064, 15095, 15126, 15158, 15189, 15220, 15251, 15282, 15313, 15344, 15375, 15406, 15438, 15469, 15500, 15531, 15562, 15593, 15624, 15655, 15686, 15717, 15748, 15779, 15810, 15842, 15873, 15904, 15935, 15966, 15997, 16028, 16059, 16090, 16121, 16152, 16183, 16214, 16245, 16276, 16307, 16338, 16369, 16400, 16431, 16462, 16493, 16524, 16555, 16586, 16617, 16648, 16679, 16709, 16740, 16771, 16802, 16833, 16864, 16895, 16926, 16957, 16988, 17019, 17050, 17080, 17111, 17142, 17173, 17204, 17235, 17266, 17297, 17327, 17358, 17389, 17420, 17451, 17482, 17513, 17543, 17574, 17605, 17636, 17667, 17698, 17728, 17759, 17790, 17821, 17852, 17882, 17913, 17944, 17975, 18005, 18036, 18067, 18098, 18128, 18159, 18190, 18221, 18251, 18282, 18313, 18344, 18374, 18405, 18436, 18466, 18497, 18528, 18559, 18589, 18620, 18651, 18681, 18712, 18743, 18773, 18804, 18835, 18865, 18896, 18927, 18957, 18988, 19018, 19049, 19080, 19110, 19141, 19171, 19202, 19233, 19263, 19294, 19324, 19355, 19386, 19416, 19447, 19477, 19508, 19538, 19569, 19599, 19630, 19660, 19691, 19722, 19752, 19783, 19813, 19844, 19874, 19905, 19935, 19966, 19996, 20026, 20057, 20087, 20118, 20148, 20179, 20209, 20240, 20270, 20300, 20331, 20361, 20392, 20422, 20453, 20483, 20513, 20544, 20574, 20604, 20635, 20665, 20696, 20726, 20756, 20787, 20817, 20847, 20878, 20908, 20938, 20969, 20999, 21029, 21060, 21090, 21120, 21150, 21181, 21211, 21241, 21272, 21302, 21332, 21362, 21393, 21423, 21453, 21483, 21514, 21544, 21574, 21604, 21634, 21665, 21695, 21725, 21755, 21785, 21816, 21846, 21876, 21906, 21936, 21966, 21997, 22027, 22057, 22087, 22117, 22147, 22177, 22207, 22238, 22268, 22298, 22328, 22358, 22388, 22418, 22448, 22478, 22508, 22538, 22568, 22598, 22628, 22658, 22688, 22718, 22748, 22778, 22808, 22838, 22868, 22898, 22928, 22958, 22988, 23018, 23048, 23078, 23108, 23138, 23168, 23198, 23228, 23258, 23288, 23318, 23348, 23377, 23407, 23437, 23467, 23497, 23527, 23557, 23587, 23616, 23646, 23676, 23706, 23736, 23766, 23795, 23825, 23855, 23885, 23915, 23944, 23974, 24004, 24034, 24064, 24093, 24123, 24153, 24183, 24212, 24242, 24272, 24302, 24331, 24361, 24391, 24420, 24450, 24480, 24509, 24539, 24569, 24598, 24628, 24658, 24687, 24717, 24747, 24776, 24806, 24836, 24865, 24895, 24924, 24954, 24983, 25013, 25043, 25072, 25102, 25131, 25161, 25190, 25220, 25250, 25279, 25309, 25338, 25368, 25397, 25427, 25456, 25486, 25515, 25544, 25574, 25603, 25633, 25662, 25692, 25721, 25751, 25780, 25809, 25839, 25868, 25898, 25927, 25956, 25986, 26015, 26045, 26074, 26103, 26133, 26162, 26191, 26221, 26250, 26279, 26309, 26338, 26367, 26397, 26426, 26455, 26484, 26514, 26543, 26572, 26601, 26631, 26660, 26689, 26718, 26748, 26777, 26806, 26835, 26864, 26894, 26923, 26952, 26981, 27010, 27039, 27068, 27098, 27127, 27156, 27185, 27214, 27243, 27272, 27301, 27331, 27360, 27389, 27418, 27447, 27476, 27505, 27534, 27563, 27592, 27621, 27650, 27679, 27708, 27737, 27766, 27795, 27824, 27853, 27882, 27911, 27940, 27969, 27998, 28027, 28056, 28084, 28113, 28142, 28171, 28200, 28229, 28258, 28287, 28316, 28344, 28373, 28402, 28431, 28460, 28489, 28517, 28546, 28575, 28604, 28633, 28661, 28690, 28719, 28748, 28776, 28805, 28834, 28863, 28891, 28920, 28949, 28978, 29006, 29035, 29064, 29092, 29121, 29150, 29178, 29207, 29236, 29264, 29293, 29321, 29350, 29379, 29407, 29436, 29464, 29493, 29522, 29550, 29579, 29607, 29636, 29664, 29693, 29721, 29750, 29778, 29807, 29835, 29864, 29892, 29921, 29949, 29978, 30006, 30035, 30063, 30092, 30120, 30148, 30177, 30205, 30234, 30262, 30290, 30319, 30347, 30376, 30404, 30432, 30461, 30489, 30517, 30546, 30574, 30602, 30630, 30659, 30687, 30715, 30744, 30772, 30800, 30828, 30856, 30885, 30913, 30941, 30969, 30998, 31026, 31054, 31082, 31110, 31138, 31167, 31195, 31223, 31251, 31279, 31307, 31335, 31363, 31392, 31420, 31448, 31476, 31504, 31532, 31560, 31588, 31616, 31644, 31672, 31700, 31728, 31756, 31784, 31812, 31840, 31868, 31896, 31924, 31952, 31980, 32008, 32036, 32064, 32091, 32119, 32147, 32175, 32203, 32231, 32259, 32287, 32314, 32342, 32370, 32398, 32426, 32454, 32481, 32509, 32537, 32565, 32592, 32620, 32648, 32676, 32703, 32731, 32759, 32787, 32814, 32842, 32870, 32897, 32925, 32953, 32980, 33008, 33036, 33063, 33091, 33118, 33146, 33174, 33201, 33229, 33256, 33284, 33312, 33339, 33367, 33394, 33422, 33449, 33477, 33504, 33532, 33559, 33587, 33614, 33642, 33669, 33697, 33724, 33751, 33779, 33806, 33834, 33861, 33889, 33916, 33943, 33971, 33998, 34025, 34053, 34080, 34107, 34135, 34162, 34189, 34217, 34244, 34271, 34298, 34326, 34353, 34380, 34407, 34435, 34462, 34489, 34516, 34544, 34571, 34598, 34625, 34652, 34679, 34707, 34734, 34761, 34788, 34815, 34842, 34869, 34896, 34923, 34951, 34978, 35005, 35032, 35059, 35086, 35113, 35140, 35167, 35194, 35221, 35248, 35275, 35302, 35329, 35356, 35383, 35409, 35436, 35463, 35490, 35517, 35544, 35571, 35598, 35625, 35651, 35678, 35705, 35732, 35759, 35786, 35812, 35839, 35866, 35893, 35920, 35946, 35973, 36000, 36027, 36053, 36080, 36107, 36133, 36160, 36187, 36213, 36240, 36267, 36293, 36320, 36347, 36373, 36400, 36427, 36453, 36480, 36506, 36533, 36559, 36586, 36613, 36639, 36666, 36692, 36719, 36745, 36772, 36798, 36825, 36851, 36878, 36904, 36930, 36957, 36983, 37010, 37036, 37062, 37089, 37115, 37142, 37168, 37194, 37221, 37247, 37273, 37300, 37326, 37352, 37379, 37405, 37431, 37457, 37484, 37510, 37536, 37562, 37589, 37615, 37641, 37667, 37693, 37719, 37746, 37772, 37798, 37824, 37850, 37876, 37902, 37929, 37955, 37981, 38007, 38033, 38059, 38085, 38111, 38137, 38163, 38189, 38215, 38241, 38267, 38293, 38319, 38345, 38371, 38397, 38423, 38449, 38475, 38500, 38526, 38552, 38578, 38604, 38630, 38656, 38682, 38707, 38733, 38759, 38785, 38811, 38836, 38862, 38888, 38914, 38939, 38965, 38991, 39017, 39042, 39068, 39094, 39119, 39145, 39171, 39196, 39222, 39248, 39273, 39299, 39324, 39350, 39376, 39401, 39427, 39452, 39478, 39503, 39529, 39554, 39580, 39605, 39631, 39656, 39682, 39707, 39733, 39758, 39784, 39809, 39835, 39860, 39885, 39911, 39936, 39961, 39987, 40012, 40037, 40063, 40088, 40113, 40139, 40164, 40189, 40215, 40240, 40265, 40290, 40316, 40341, 40366, 40391, 40416, 40442, 40467, 40492, 40517, 40542, 40567, 40593, 40618, 40643, 40668, 40693, 40718, 40743, 40768, 40793, 40818, 40843, 40868, 40893, 40918, 40943, 40968, 40993, 41018, 41043, 41068, 41093, 41118, 41143, 41168, 41193, 41218, 41242, 41267, 41292, 41317, 41342, 41367, 41391, 41416, 41441, 41466, 41491, 41515, 41540, 41565, 41590, 41614, 41639, 41664, 41688, 41713, 41738, 41762, 41787, 41812, 41836, 41861, 41886, 41910, 41935, 41959, 41984, 42009, 42033, 42058, 42082, 42107, 42131, 42156, 42180, 42205, 42229, 42254, 42278, 42303, 42327, 42351, 42376, 42400, 42425, 42449, 42473, 42498, 42522, 42547, 42571, 42595, 42619, 42644, 42668, 42692, 42717, 42741, 42765, 42789, 42814, 42838, 42862, 42886, 42910, 42935, 42959, 42983, 43007, 43031, 43055, 43080, 43104, 43128, 43152, 43176, 43200, 43224, 43248, 43272, 43296, 43320, 43344, 43368, 43392, 43416, 43440, 43464, 43488, 43512, 43536, 43560, 43584, 43608, 43631, 43655, 43679, 43703, 43727, 43751, 43775, 43798, 43822, 43846, 43870, 43893, 43917, 43941, 43965, 43988, 44012, 44036, 44060, 44083, 44107, 44131, 44154, 44178, 44201, 44225, 44249, 44272, 44296, 44319, 44343, 44367, 44390, 44414, 44437, 44461, 44484, 44508, 44531, 44555, 44578, 44602, 44625, 44648, 44672, 44695, 44719, 44742, 44765, 44789, 44812, 44836, 44859, 44882, 44905, 44929, 44952, 44975, 44999, 45022, 45045, 45068, 45092, 45115, 45138, 45161, 45184, 45208, 45231, 45254, 45277, 45300, 45323, 45346, 45369, 45393, 45416, 45439, 45462, 45485, 45508, 45531, 45554, 45577, 45600, 45623, 45646, 45669, 45692, 45715, 45738, 45760, 45783, 45806, 45829, 45852, 45875, 45898, 45921, 45943, 45966, 45989, 46012, 46035, 46057, 46080, 46103, 46126, 46148, 46171, 46194, 46216, 46239, 46262, 46284, 46307, 46330, 46352, 46375, 46398, 46420, 46443, 46465, 46488, 46510, 46533, 46556, 46578, 46601, 46623, 46646, 46668, 46690, 46713, 46735, 46758, 46780, 46803, 46825, 46847, 46870, 46892, 46914, 46937, 46959, 46981, 47004, 47026, 47048, 47071, 47093, 47115, 47137, 47160, 47182, 47204, 47226, 47248, 47271, 47293, 47315, 47337, 47359, 47381, 47403, 47425, 47447, 47470, 47492, 47514, 47536, 47558, 47580, 47602, 47624, 47646, 47668, 47690, 47712, 47733, 47755, 47777, 47799, 47821, 47843, 47865, 47887, 47909, 47930, 47952, 47974, 47996, 48018, 48039, 48061, 48083, 48105, 48126, 48148, 48170, 48191, 48213, 48235, 48256, 48278, 48300, 48321, 48343, 48365, 48386, 48408, 48429, 48451, 48472, 48494, 48515, 48537, 48558, 48580, 48601, 48623, 48644, 48666, 48687, 48709, 48730, 48751, 48773, 48794, 48815, 48837, 48858, 48879, 48901, 48922, 48943, 48965, 48986, 49007, 49028, 49050, 49071, 49092, 49113, 49134, 49156, 49177, 49198, 49219, 49240, 49261, 49282, 49303, 49325, 49346, 49367, 49388, 49409, 49430, 49451, 49472, 49493, 49514, 49535, 49556, 49577, 49597, 49618, 49639, 49660, 49681, 49702, 49723, 49744, 49764, 49785, 49806, 49827, 49848, 49868, 49889, 49910, 49931, 49951, 49972, 49993, 50013, 50034, 50055, 50075, 50096, 50117, 50137, 50158, 50178, 50199, 50220, 50240, 50261, 50281, 50302, 50322, 50343, 50363, 50384, 50404, 50425, 50445, 50465, 50486, 50506, 50527, 50547, 50567, 50588, 50608, 50628, 50649, 50669, 50689, 50710, 50730, 50750, 50770, 50791, 50811, 50831, 50851, 50871, 50892, 50912, 50932, 50952, 50972, 50992, 51012, 51032, 51052, 51072, 51093, 51113, 51133, 51153, 51173, 51193, 51213, 51233, 51252, 51272, 51292, 51312, 51332, 51352, 51372, 51392, 51412, 51431, 51451, 51471, 51491, 51511, 51530, 51550, 51570, 51590, 51609, 51629, 51649, 51669, 51688, 51708, 51728, 51747, 51767, 51786, 51806, 51826, 51845, 51865, 51884, 51904, 51923, 51943, 51962, 51982, 52001, 52021, 52040, 52060, 52079, 52099, 52118, 52137, 52157, 52176, 52196, 52215, 52234, 52254, 52273, 52292, 52311, 52331, 52350, 52369, 52388, 52408, 52427, 52446, 52465, 52484, 52504, 52523, 52542, 52561, 52580, 52599, 52618, 52637, 52656, 52675, 52694, 52713, 52732, 52751, 52770, 52789, 52808, 52827, 52846, 52865, 52884, 52903, 52922, 52941, 52960, 52978, 52997, 53016, 53035, 53054, 53072, 53091, 53110, 53129, 53147, 53166, 53185, 53204, 53222, 53241, 53260, 53278, 53297, 53315, 53334, 53353, 53371, 53390, 53408, 53427, 53445, 53464, 53482, 53501, 53519, 53538, 53556, 53575, 53593, 53612, 53630, 53648, 53667, 53685, 53703, 53722, 53740, 53758, 53777, 53795, 53813, 53831, 53850, 53868, 53886, 53904, 53923, 53941, 53959, 53977, 53995, 54013, 54031, 54050, 54068, 54086, 54104, 54122, 54140, 54158, 54176, 54194, 54212, 54230, 54248, 54266, 54284, 54302, 54320, 54337, 54355, 54373, 54391, 54409, 54427, 54445, 54462, 54480, 54498, 54516, 54533, 54551, 54569, 54587, 54604, 54622, 54640, 54657, 54675, 54693, 54710, 54728, 54746, 54763, 54781, 54798, 54816, 54833, 54851, 54868, 54886, 54903, 54921, 54938, 54956, 54973, 54991, 55008, 55025, 55043, 55060, 55077, 55095, 55112, 55129, 55147, 55164, 55181, 55198, 55216, 55233, 55250, 55267, 55285, 55302, 55319, 55336, 55353, 55370, 55387, 55405, 55422, 55439, 55456, 55473, 55490, 55507, 55524, 55541, 55558, 55575, 55592, 55609, 55626, 55642, 55659, 55676, 55693, 55710, 55727, 55744, 55761, 55777, 55794, 55811, 55828, 55844, 55861, 55878, 55895, 55911, 55928, 55945, 55961, 55978, 55995, 56011, 56028, 56044, 56061, 56078, 56094, 56111, 56127, 56144, 56160, 56177, 56193, 56210, 56226, 56243, 56259, 56275, 56292, 56308, 56324, 56341, 56357, 56373, 56390, 56406, 56422, 56439, 56455, 56471, 56487, 56504, 56520, 56536, 56552, 56568, 56585, 56601, 56617, 56633, 56649, 56665, 56681, 56697, 56713, 56729, 56745, 56761, 56777, 56793, 56809, 56825, 56841, 56857, 56873, 56889, 56905, 56921, 56936, 56952, 56968, 56984, 57000, 57015, 57031, 57047, 57063, 57078, 57094, 57110, 57126, 57141, 57157, 57173, 57188, 57204, 57219, 57235, 57251, 57266, 57282, 57297, 57313, 57328, 57344, 57359, 57375, 57390, 57406, 57421, 57437, 57452, 57467, 57483, 57498, 57513, 57529, 57544, 57559, 57575, 57590, 57605, 57620, 57636, 57651, 57666, 57681, 57697, 57712, 57727, 57742, 57757, 57772, 57787, 57802, 57817, 57833, 57848, 57863, 57878, 57893, 57908, 57923, 57938, 57953, 57967, 57982, 57997, 58012, 58027, 58042, 58057, 58072, 58086, 58101, 58116, 58131, 58146, 58160, 58175, 58190, 58205, 58219, 58234, 58249, 58263, 58278, 58293, 58307, 58322, 58336, 58351, 58365, 58380, 58395, 58409, 58424, 58438, 58453, 58467, 58481, 58496, 58510, 58525, 58539, 58553, 58568, 58582, 58597, 58611, 58625, 58639, 58654, 58668, 58682, 58697, 58711, 58725, 58739, 58753, 58768, 58782, 58796, 58810, 58824, 58838, 58852, 58866, 58880, 58894, 58908, 58922, 58936, 58950, 58964, 58978, 58992, 59006, 59020, 59034, 59048, 59062, 59076, 59090, 59103, 59117, 59131, 59145, 59159, 59172, 59186, 59200, 59214, 59227, 59241, 59255, 59268, 59282, 59296, 59309, 59323, 59336, 59350, 59364, 59377, 59391, 59404, 59418, 59431, 59445, 59458, 59472, 59485, 59498, 59512, 59525, 59539, 59552, 59565, 59579, 59592, 59605, 59619, 59632, 59645, 59658, 59672, 59685, 59698, 59711, 59724, 59738, 59751, 59764, 59777, 59790, 59803, 59816, 59829, 59842, 59855, 59868, 59881, 59894, 59907, 59920, 59933, 59946, 59959, 59972, 59985, 59998, 60011, 60024, 60036, 60049, 60062, 60075, 60088, 60100, 60113, 60126, 60139, 60151, 60164, 60177, 60189, 60202, 60215, 60227, 60240, 60253, 60265, 60278, 60290, 60303, 60315, 60328, 60340, 60353, 60365, 60378, 60390, 60403, 60415, 60427, 60440, 60452, 60464, 60477, 60489, 60501, 60514, 60526, 60538, 60551, 60563, 60575, 60587, 60599, 60612, 60624, 60636, 60648, 60660, 60672, 60684, 60696, 60708, 60720, 60733, 60745, 60757, 60769, 60781, 60792, 60804, 60816, 60828, 60840, 60852, 60864, 60876, 60888, 60899, 60911, 60923, 60935, 60947, 60958, 60970, 60982, 60994, 61005, 61017, 61029, 61040, 61052, 61064, 61075, 61087, 61098, 61110, 61121, 61133, 61145, 61156, 61168, 61179, 61190, 61202, 61213, 61225, 61236, 61248, 61259, 61270, 61282, 61293, 61304, 61316, 61327, 61338, 61349, 61361, 61372, 61383, 61394, 61406, 61417, 61428, 61439, 61450, 61461, 61472, 61483, 61495, 61506, 61517, 61528, 61539, 61550, 61561, 61572, 61583, 61593, 61604, 61615, 61626, 61637, 61648, 61659, 61670, 61680, 61691, 61702, 61713, 61724, 61734, 61745, 61756, 61767, 61777, 61788, 61799, 61809, 61820, 61830, 61841, 61852, 61862, 61873, 61883, 61894, 61904, 61915, 61925, 61936, 61946, 61957, 61967, 61977, 61988, 61998, 62009, 62019, 62029, 62040, 62050, 62060, 62071, 62081, 62091, 62101, 62111, 62122, 62132, 62142, 62152, 62162, 62172, 62183, 62193, 62203, 62213, 62223, 62233, 62243, 62253, 62263, 62273, 62283, 62293, 62303, 62313, 62323, 62332, 62342, 62352, 62362, 62372, 62382, 62391, 62401, 62411, 62421, 62431, 62440, 62450, 62460, 62469, 62479, 62489, 62498, 62508, 62518, 62527, 62537, 62546, 62556, 62565, 62575, 62584, 62594, 62603, 62613, 62622, 62632, 62641, 62650, 62660, 62669, 62679, 62688, 62697, 62707, 62716, 62725, 62734, 62744, 62753, 62762, 62771, 62780, 62790, 62799, 62808, 62817, 62826, 62835, 62844, 62853, 62863, 62872, 62881, 62890, 62899, 62908, 62917, 62925, 62934, 62943, 62952, 62961, 62970, 62979, 62988, 62997, 63005, 63014, 63023, 63032, 63040, 63049, 63058, 63067, 63075, 63084, 63093, 63101, 63110, 63119, 63127, 63136, 63144, 63153, 63161, 63170, 63178, 63187, 63195, 63204, 63212, 63221, 63229, 63238, 63246, 63254, 63263, 63271, 63279, 63288, 63296, 63304, 63313, 63321, 63329, 63337, 63346, 63354, 63362, 63370, 63378, 63386, 63395, 63403, 63411, 63419, 63427, 63435, 63443, 63451, 63459, 63467, 63475, 63483, 63491, 63499, 63507, 63515, 63522, 63530, 63538, 63546, 63554, 63562, 63569, 63577, 63585, 63593, 63600, 63608, 63616, 63623, 63631, 63639, 63646, 63654, 63662, 63669, 63677, 63684, 63692, 63699, 63707, 63714, 63722, 63729, 63737, 63744, 63752, 63759, 63767, 63774, 63781, 63789, 63796, 63803, 63811, 63818, 63825, 63832, 63840, 63847, 63854, 63861, 63868, 63876, 63883, 63890, 63897, 63904, 63911, 63918, 63925, 63932, 63939, 63946, 63953, 63960, 63967, 63974, 63981, 63988, 63995, 64002, 64009, 64016, 64023, 64029, 64036, 64043, 64050, 64057, 64063, 64070, 64077, 64083, 64090, 64097, 64103, 64110, 64117, 64123, 64130, 64137, 64143, 64150, 64156, 64163, 64169, 64176, 64182, 64189, 64195, 64202, 64208, 64214, 64221, 64227, 64234, 64240, 64246, 64252, 64259, 64265, 64271, 64278, 64284, 64290, 64296, 64302, 64309, 64315, 64321, 64327, 64333, 64339, 64345, 64351, 64357, 64363, 64369, 64375, 64381, 64387, 64393, 64399, 64405, 64411, 64417, 64423, 64429, 64435, 64440, 64446, 64452, 64458, 64464, 64469, 64475, 64481, 64487, 64492, 64498, 64504, 64509, 64515, 64521, 64526, 64532, 64537, 64543, 64548, 64554, 64559, 64565, 64570, 64576, 64581, 64587, 64592, 64598, 64603, 64608, 64614, 64619, 64624, 64630, 64635, 64640, 64646, 64651, 64656, 64661, 64666, 64672, 64677, 64682, 64687, 64692, 64697, 64702, 64708, 64713, 64718, 64723, 64728, 64733, 64738, 64743, 64748, 64753, 64757, 64762, 64767, 64772, 64777, 64782, 64787, 64792, 64796, 64801, 64806, 64811, 64815, 64820, 64825, 64829, 64834, 64839, 64843, 64848, 64853, 64857, 64862, 64866, 64871, 64876, 64880, 64885, 64889, 64894, 64898, 64902, 64907, 64911, 64916, 64920, 64924, 64929, 64933, 64938, 64942, 64946, 64950, 64955, 64959, 64963, 64967, 64972, 64976, 64980, 64984, 64988, 64992, 64996, 65000, 65005, 65009, 65013, 65017, 65021, 65025, 65029, 65033, 65037, 65041, 65044, 65048, 65052, 65056, 65060, 65064, 65068, 65071, 65075, 65079, 65083, 65087, 65090, 65094, 65098, 65101, 65105, 65109, 65112, 65116, 65120, 65123, 65127, 65130, 65134, 65137, 65141, 65144, 65148, 65151, 65155, 65158, 65162, 65165, 65168, 65172, 65175, 65179, 65182, 65185, 65189, 65192, 65195, 65198, 65202, 65205, 65208, 65211, 65214, 65218, 65221, 65224, 65227, 65230, 65233, 65236, 65239, 65242, 65245, 65248, 65251, 65254, 65257, 65260, 65263, 65266, 65269, 65272, 65275, 65277, 65280, 65283, 65286, 65289, 65291, 65294, 65297, 65300, 65302, 65305, 65308, 65310, 65313, 65316, 65318, 65321, 65323, 65326, 65329, 65331, 65334, 65336, 65339, 65341, 65344, 65346, 65348, 65351, 65353, 65356, 65358, 65360, 65363, 65365, 65367, 65370, 65372, 65374, 65376, 65379, 65381, 65383, 65385, 65387, 65389, 65392, 65394, 65396, 65398, 65400, 65402, 65404, 65406, 65408, 65410, 65412, 65414, 65416, 65418, 65420, 65422, 65424, 65425, 65427, 65429, 65431, 65433, 65435, 65436, 65438, 65440, 65442, 65443, 65445, 65447, 65448, 65450, 65452, 65453, 65455, 65456, 65458, 65459, 65461, 65463, 65464, 65466, 65467, 65468, 65470, 65471, 65473, 65474, 65476, 65477, 65478, 65480, 65481, 65482, 65483, 65485, 65486, 65487, 65488, 65490, 65491, 65492, 65493, 65494, 65496, 65497, 65498, 65499, 65500, 65501, 65502, 65503, 65504, 65505, 65506, 65507, 65508, 65509, 65510, 65511, 65512, 65512, 65513, 65514, 65515, 65516, 65516, 65517, 65518, 65519, 65519, 65520, 65521, 65522, 65522, 65523, 65524, 65524, 65525, 65525, 65526, 65526, 65527, 65527, 65528, 65528, 65529, 65529, 65530, 65530, 65531, 65531, 65532, 65532, 65532, 65533, 65533, 65533, 65533, 65534, 65534, 65534, 65534, 65535, 65535, 65535, 65535, 65535, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536, 65536
};
#endif

fix16_t fix16_sin_parabola(fix16_t inAngle)
{
	fix16_t abs_inAngle, abs_retval, retval;
	fix16_t mask;

	/* Absolute function */
	mask = (inAngle >> (sizeof(fix16_t)*CHAR_BIT-1));
	abs_inAngle = (inAngle + mask) ^ mask;
	
	/* On 0->PI, sin looks like x² that is :
	   - centered on PI/2,
	   - equals 1 on PI/2,
	   - equals 0 on 0 and PI
	  that means :  4/PI * x  - 4/PI² * x²
	  Use abs(x) to handle (-PI) -> 0 zone.
	 */
	retval = fix16_mul(FOUR_DIV_PI, inAngle) + fix16_mul( fix16_mul(_FOUR_DIV_PI2, inAngle), abs_inAngle );
	/* At this point, retval equals sin(inAngle) on important points ( -PI, -PI/2, 0, PI/2, PI),
	   but is not very precise between these points
	 */
	#ifndef FIXMATH_FAST_SIN
	/* Absolute value of retval */
	mask = (retval >> (sizeof(fix16_t)*CHAR_BIT-1));
	abs_retval = (retval + mask) ^ mask;
	/* So improve its precision by adding some x^4 component to retval */
	retval += fix16_mul(X4_CORRECTION_COMPONENT, fix16_mul(retval, abs_retval) - retval );
	#endif
	return retval;
}

fix16_t fix16_sin(fix16_t inAngle)
{
#if 1
	char neg = 0;
	fix16_t angle = inAngle % (fix16_pi << 1);
	if (angle < 0)
		angle += (fix16_pi << 1);

	if (angle > fix16_pi)
	{
		neg = 1;
		angle = (fix16_pi << 1) - angle;
	}
	if (angle > (fix16_pi >> 1))
		angle = fix16_pi - angle;
	int tempIndex = ((angle >> 5) & 0x00000FFF);
	if (neg)
		return -_fix16_sin_cache_value[tempIndex];
	return _fix16_sin_cache_value[tempIndex];
#else
	fix16_t tempAngle = inAngle % (fix16_pi << 1);

	#ifdef FIXMATH_SIN_LUT
	if(tempAngle < 0)
		tempAngle += (fix16_pi << 1);

	fix16_t tempOut;
	if(tempAngle >= fix16_pi) {
		tempAngle -= fix16_pi;
		if(tempAngle >= (fix16_pi >> 1))
			tempAngle = fix16_pi - tempAngle;
		tempOut = -(tempAngle >= _fix16_sin_lut_count ? fix16_one : _fix16_sin_lut[tempAngle]);
	} else {
		if(tempAngle >= (fix16_pi >> 1))
			tempAngle = fix16_pi - tempAngle;
		tempOut = (tempAngle >= _fix16_sin_lut_count ? fix16_one : _fix16_sin_lut[tempAngle]);
	}
	#else
	if(tempAngle > fix16_pi)
		tempAngle -= (fix16_pi << 1);
	else if(tempAngle < -fix16_pi)
		tempAngle += (fix16_pi << 1);


	fix16_t tempAngleSq = fix16_mul(tempAngle, tempAngle);

	#ifndef FIXMATH_FAST_SIN // Most accurate version, accurate to ~2.1%
	fix16_t tempOut = tempAngle;
	tempAngle = fix16_mul(tempAngle, tempAngleSq);
	tempOut -= (tempAngle / 6);
	tempAngle = fix16_mul(tempAngle, tempAngleSq);
	tempOut += (tempAngle / 120);
	tempAngle = fix16_mul(tempAngle, tempAngleSq);
	tempOut -= (tempAngle / 5040);
	tempAngle = fix16_mul(tempAngle, tempAngleSq);
	tempOut += (tempAngle / 362880);
	tempAngle = fix16_mul(tempAngle, tempAngleSq);
	tempOut -= (tempAngle / 39916800);
	#else // Fast implementation, runs at 159% the speed of above 'accurate' version with an slightly lower accuracy of ~2.3%
	fix16_t tempOut;
	tempOut = fix16_mul(-13, tempAngleSq) + 546;
	tempOut = fix16_mul(tempOut, tempAngleSq) - 10923;
	tempOut = fix16_mul(tempOut, tempAngleSq) + 65536;
	tempOut = fix16_mul(tempOut, tempAngle);
	#endif


	#endif

	return tempOut;
#endif
}

fix16_t fix16_cos(fix16_t inAngle)
{
	return fix16_sin(inAngle + (fix16_pi >> 1));
}
#if 0
#ifndef FIXMATH_NO_CACHE
static fix16_t _fix16_atan_cache_index[2][4096] = { { 0 }, { 0 } };
static fix16_t _fix16_atan_cache_value[4096] = { 0 };
#endif


fix16_t fix16_tan(fix16_t inAngle)
{
	return fix16_sdiv(fix16_sin(inAngle), fix16_cos(inAngle));
}

fix16_t fix16_asin(fix16_t x)
{
	if((x > fix16_one)
		|| (x < -fix16_one))
		return 0;

	fix16_t out;
	out = (fix16_one - fix16_mul(x, x));
	out = fix16_div(x, fix16_sqrt(out));
	out = fix16_atan(out);
	return out;
}

fix16_t fix16_acos(fix16_t x)
{
	return ((fix16_pi >> 1) - fix16_asin(x));
}

fix16_t fix16_atan2(fix16_t inY , fix16_t inX)
{
	fix16_t abs_inY, mask, angle, r, r_3;

	#ifndef FIXMATH_NO_CACHE
	uintptr_t hash = (inX ^ inY);
	hash ^= hash >> 20;
	hash &= 0x0FFF;
	if((_fix16_atan_cache_index[0][hash] == inX) && (_fix16_atan_cache_index[1][hash] == inY))
		return _fix16_atan_cache_value[hash];
	#endif

	/* Absolute inY */
	mask = (inY >> (sizeof(fix16_t)*CHAR_BIT-1));
	abs_inY = (inY + mask) ^ mask;

	if (inX >= 0)
	{
		r = fix16_div( (inX - abs_inY), (inX + abs_inY));
		r_3 = fix16_mul(fix16_mul(r, r),r);
		angle = fix16_mul(0x00003240 , r_3) - fix16_mul(0x0000FB50,r) + PI_DIV_4;
	} else {
		r = fix16_div( (inX + abs_inY), (abs_inY - inX));
		r_3 = fix16_mul(fix16_mul(r, r),r);
		angle = fix16_mul(0x00003240 , r_3)
			- fix16_mul(0x0000FB50,r)
			+ THREE_PI_DIV_4;
	}
	if (inY < 0)
	{
		angle = -angle;
	}

	#ifndef FIXMATH_NO_CACHE
	_fix16_atan_cache_index[0][hash] = inX;
	_fix16_atan_cache_index[1][hash] = inY;
	_fix16_atan_cache_value[hash] = angle;
	#endif

	return angle;
}

fix16_t fix16_atan(fix16_t x)
{
	return fix16_atan2(x, fix16_one);
}
#endif

#endif